Quotes — Django приложение с «умной» случайной цитатой
Коротко: веб‑приложение на Django, которое при каждом открытии показывает случайную цитату из фильма или книги с учётом «веса» цитаты, считает просмотры, даёт поставить лайк/дизлайк, а также имеет страницу топ‑10 популярных цитат. Данные управляются через UI (админка и формы), дубликаты запрещены, на источник — не более трёх цитат.

Возможности
Случайная цитата на главной странице с учетом «веса» (чем выше вес, тем выше вероятность показа).

Счётчик просмотров обновляется без перезагрузки страницы.

Лайк/дизлайк для цитаты, рейтинг учитывается в «Популярном».

Интерфейс добавления/редактирования источников и цитат (через админку и формы).

Ограничения доменной логики:

Нельзя добавлять дубликаты текста цитаты.

У одного источника не более трёх цитат одновременно.

Вес задаётся при добавлении и может редактироваться.

Отдельная страница «Популярное» с топ‑10 по лайкам, плюс доп. фильтры/сортировки.

Лёгкий интерактив с HTMX (минимум JS), серверный рендер через шаблоны Django.

Архитектура
Ядро: Django 5.x, PostgreSQL.

Модели:

Source(name, kind) — источник (фильм/книга/другое).

Quote(text, source, weight, views, created_at) — цитата; уникальный текст; индекс по source; инварианты валидируются.

Vote(user, quote, value) — голос (+1/-1); уникальность по паре (user, quote).

Выбор случайной цитаты:

Алгоритм «weighted random»: вероятность показа пропорциональна полю weight.

Реализация без сканирования всей таблицы: либо запрос с аннотацией и выбором по псевдослучайному ключу, либо Python‑взвешивание на сэмпле (см. раздел «Алгоритм»).

Интерфейс:

Шаблоны Django + HTMX для лайков/просмотров без перезагрузки.

Админка: удобные колонки, фильтры, поиск по тексту/источнику.

Ограничения и целостность:

unique=True для Quote.text, clean() на модели Quote ограничивает до трёх цитат на Source.

Индексы по ForeignKey для быстрой агрегации.

Транзакционная валидация при сохранении (transaction.atomic()).

Алгоритм «взвешенной случайной»
Есть два варианта (в проекте активирован простой и надёжный):

Вариант A (простой и понятный):

Берём небольшой сэмпл свежих цитат (например, последние N), выполняем взвешенный случайный выбор в Python: сумма весов, случайное число r в диапазоне [1, sum], проходим по кумулятивной сумме.

Плюс: минимальная сложность реализации, стабильная работа на Postgres любой версии.

Вариант B (БД‑ориентированный):

Аннотируем запрос весом, используем распределение с ORDER BY random() ограниченным диапазоном, либо генерируем псевдо‑случайный ключ с seed и cutoff по кумулятивной сумме.

Плюс: перенос вычислений в БД, минус: сложнее поддерживать и тестировать.

Выбор сделан в пользу A; при росте объёма данных легко переключиться на B.

Скриншоты
Главная: случайная цитата, лайк/дизлайк, счётчик просмотров.

Популярное: таблица топ‑10 по лайкам, сортировки/фильтры.

Админка: управление Sources/Quotes/Votes.

(Добавьте изображения в папку docs/ и вставьте ссылки.)

Быстрый старт (Docker)
Требования: Docker, Docker Compose.

Клонировать репозиторий

git clone https://github.com/<ORG_OR_USER>/quotes



