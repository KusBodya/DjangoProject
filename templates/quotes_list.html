{% extends "base.html" %}
{% block content %}

<form method="get" style="margin-bottom:16px; display:flex; gap:8px; flex-wrap:wrap">
  <input type="text" name="q" placeholder="–ò—Å—Ç–æ—á–Ω–∏–∫/–ê–≤—Ç–æ—Ä" value="{{ filters.q }}" />
  <select name="kind">
    <option value="">–õ—é–±–æ–π —Ç–∏–ø</option>
    <option value="book"  {% if filters.kind == "book" %}selected{% endif %}>–ö–Ω–∏–≥–∞</option>
    <option value="film"  {% if filters.kind == "film" %}selected{% endif %}>–§–∏–ª—å–º</option>
    <option value="other" {% if filters.kind == "other" %}selected{% endif %}>–î—Ä—É–≥–æ–µ</option>
  </select>
  <select name="order">
    <option value="date"  {% if filters.order == "date" %}selected{% endif %}>–ü–æ –¥–∞—Ç–µ</option>
    <option value="likes" {% if filters.order == "likes" %}selected{% endif %}>–ü–æ –ª–∞–π–∫–∞–º</option>
    <option value="views" {% if filters.order == "views" %}selected{% endif %}>–ü–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º</option>
  </select>
  <select name="dir">
    <option value="desc" {% if filters.dir == "desc" %}selected{% endif %}>‚á©</option>
    <option value="asc"  {% if filters.dir == "asc"  %}selected{% endif %}>‚áß</option>
  </select>
  <button type="submit">–ü–æ–∫–∞–∑–∞—Ç—å</button>
</form>

{% if top10 %}
  <h3>–¢–æ–ø‚Äë10 –ø–æ –ª–∞–π–∫–∞–º</h3>
  <ol style="margin-top:8px">
    {% for q in top10 %}
      <li>
        {{ q.text|truncatechars:100 }}
        <small> ‚Äî {{ q.source.name }} ({{ q.source.kind }})</small>
        <span style="margin-left:8px">
          Likes: {{ q.likes_count }} | Dislikes: {{ q.dislikes_count }} | Views: {{ q.views }}
        </span>
      </li>
    {% endfor %}
  </ol>
  <hr />
{% endif %}

{% for q in quotes %}
  <article id="quote-{{ q.id }}">
    <p>{{ q.text }}</p>
    <small>–ò—Å—Ç–æ—á–Ω–∏–∫: {{ q.source.name }} ({{ q.source.kind }})</small>

    <div style="margin: 8px 0">
      <button
        hx-post="{% url 'quote_like' q.id %}"
        hx-target="#quote-{{ q.id }}-votes"
        hx-swap="outerHTML">üëç Like</button>
      <button
        hx-post="{% url 'quote_dislike' q.id %}"
        hx-target="#quote-{{ q.id }}-votes"
        hx-swap="outerHTML">üëé Dislike</button>
      <span id="quote-{{ q.id }}-votes">
        Likes: {{ q.likes_count }} | Dislikes: {{ q.dislikes_count }}
      </span>
    </div>

    <span id="quote-{{ q.id }}-views">Views: {{ q.views }}</span>
    <hr />
  </article>
{% empty %}
  <p>–ü–æ–∫–∞ –Ω–µ—Ç —Ü–∏—Ç–∞—Ç.</p>
{% endfor %}

{% endblock %}
